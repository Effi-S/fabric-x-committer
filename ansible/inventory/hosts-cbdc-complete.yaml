all:
  vars:
    ansible_connection: ssh
    ansible_user: "{{lookup('env', 'USER')}}"
    binary_dir: /home/cbdcdemo/bin/
    top_config_dir: /home/cbdcdemo/config
    config_dir: "{{top_config_dir}}"
    os: linux
    prometheus_exporter_port: 2112

  children:
    services:
      vars:
        ansible_user: cbdcdemo
      children:
        coordinators:
          vars:
            service_port: 5002
            config: config-coordinator.yaml
          hosts:
            coordinator-machine:
              inherit_endorser: endorser-1 # Used for setting the sig verification key
              config_dir: "{{top_config_dir}}/coordinator"
              prometheus_exporter_port: 2113
              ansible_host: ttbed2.amsterdam3

        sigservices:
          vars:
            service_port: 5000
            config: config-sigservice.yaml
            config_dir: "{{top_config_dir}}/sigverifier"
          hosts:
            sigservice-machine1:
              ansible_host: ttbed2.london2

        shardsservices:
          vars:
            service_port: 5001
            config: config-shardsservice.yaml
            config_dir: "{{top_config_dir}}/shardsserver"
            db_dir: "{{config_dir}}/db"
          hosts:
            shardsservice-machine1:
              ansible_host: ttbed2.frankfurt2
            shardsservice-machine2:
              ansible_host: ttbed2.paris1

        orderingservices:
          vars:
            config: orderer.yaml
            organization: DefaultOrdererOrg
            domain: example.com
            service_port: 7050
            cluster_port: 7070
            admin_port: 9440
            ops_port: "{{prometheus_exporter_port}}"
            config_dir: "{{top_config_dir}}/orderer"
          hosts:
            orderingservice-machine1:
              ansible_host: ttbed1.london2
            orderingservice-machine2:
              ansible_host: ttbed1.frankfurt2
            orderingservice-machine3:
              ansible_host: ttbed1.paris1
            orderingservice-machine4:
              ansible_host: ttbed1.amsterdam3

        peerservices:
          vars:
            config: core.yaml
            profile: profile.yaml
            organization: DefaultPeerOrg
            domain: example.com
            service_port: 7050
          hosts:
            peerservice-machine1:
              config_dir: "{{top_config_dir}}/peer0"
              ansible_host: ttbed3.frankfurt2


        fscservices:
          vars:
            config: core.yaml
            demo_views: github.ibm.com/decentralized-trust-research/fts-sc/demo/views
            organization: DefaultPeerOrg
            domain: example.com
          hosts:
            lib-p2p-bootstrap-node:
              ansible_host: ttbed3.paris1
              service_port: 8000
              p2p_port: 8020
              config_dir: "{{top_config_dir}}/lib-p2p"
              bootstrap: true
            dw:
              ansible_host: ttbed3.frankfurt2
              service_port: 8001
              p2p_port: 8021
              ops_port: 8081
              web_port: 9081
              config_dir: "{{top_config_dir}}/dw"
              auditor: true
              certifier: true
              view_factories:
                - id: initRegisterAuditor
                  factory: "{{demo_views}}/RegisterAuditorViewFactory"
                - id: initRegisterCertifier
                  factory: "{{demo_views}}/RegisterCertifierViewFactory"
                - id: historyAuditing
                  factory: "{{demo_views}}/ListAuditedTransactionsViewFactory"
            issuer:
              ansible_host: ttbed3.paris1
              service_port: 8002
              p2p_port: 8022
              ops_port: 8082
              web_port: 9082
              config_dir: "{{top_config_dir}}/issuer"
              issuer_identities:
                - default
              owner_identities:
                - default
              view_factories:
                - id: issue
                  factory: "{{demo_views}}/IssueCashViewFactory"
              responders:
                - responder: "{{demo_views}}/WithdrawalResponderView"
                  initiator: "{{demo_views}}/WithdrawalInitiatorView"

            banka:
              ansible_host: ttbed3.london2
              service_port: 8003
              p2p_port: 8023
              ops_port: 8083
              web_port: 9083
              config_dir: "{{top_config_dir}}/banka"
              intermediary_identity: bankA
              owner_identities:
                - alice
                - charlie
              responders:
                - responder: "{{demo_views}}/AcceptIssuedCashView"
                  initiator: "{{demo_views}}/IssueCashView"
                - responder: "{{demo_views}}/AcceptTransferCashView"
                  initiator: "{{demo_views}}/TransferView"
              view_factories:
                - id: transfer
                  factory: "{{demo_views}}/TransferViewFactory"
                - id: balance
                  factory: "{{demo_views}}/BalanceViewFactory"
                - id: registerQRCode
                  factory: "{{demo_views}}/QRCodeRegisterViewFactory"
                - id: acceptedTransactionsHistory
                  factory: "{{demo_views}}/ListAcceptedTransactionsViewFactory"
                - id: enrollmentID
                  factory: "{{demo_views}}/GetEnrollmentIDViewFactory"
                - id: txStatusByNonce
                  factory: "{{demo_views}}/TxStatusByNonceViewFactory"
                - id: ListOwnerWalletIDsView
                  factory: "{{demo_views}}/ListOwnerWalletIDsViewFactory"
                - id: withdrawal
                  factory: "{{demo_views}}/WithdrawalInitiatorViewFactory"

            bankb:
              ansible_host: ttbed3.amsterdam3
              service_port: 8004
              p2p_port: 8024
              ops_port: 8084
              web_port: 9084
              config_dir: "{{top_config_dir}}/bankb"
              intermediary_identity: bankB
              owner_identities:
                - bob
                - dave
              responders:
                - responder: "{{demo_views}}/AcceptIssuedCashView"
                  initiator: "{{demo_views}}/IssueCashView"
                - responder: "{{demo_views}}/AcceptTransferCashView"
                  initiator: "{{demo_views}}/TransferView"
              view_factories:
                - id: transfer
                  factory: "{{demo_views}}/TransferViewFactory"
                - id: balance
                  factory: "{{demo_views}}/BalanceViewFactory"
                - id: registerQRCode
                  factory: "{{demo_views}}/QRCodeRegisterViewFactory"
                - id: acceptedTransactionsHistory
                  factory: "{{demo_views}}/ListAcceptedTransactionsViewFactory"
                - id: enrollmentID
                  factory: "{{demo_views}}/GetEnrollmentIDViewFactory"
                - id: txStatusByNonce
                  factory: "{{demo_views}}/TxStatusByNonceViewFactory"
                - id: withdrawal
                  factory: "{{demo_views}}/WithdrawalInitiatorViewFactory"
                - id: ListOwnerWalletIDsView
                  factory: "{{demo_views}}/ListOwnerWalletIDsViewFactory"
                - id: withdrawal
                  factory: "{{demo_views}}/WithdrawalInitiatorViewFactory"

            endorser-1: # Only one endorser supported currently
              ansible_host: ttbed3.paris1
              service_port: 8005
              p2p_port: 8025
              ops_port: 8083
              config_dir: "{{top_config_dir}}/endorser1"
              endorser: true
              view_factories:
                - id: listValidatedRequests
                  factory: "{{demo_views}}/ListValidatedRequestsViewFactory"

        sidecars:
          vars:
            inherit_peer: peerservice-machine1
            config: config-sidecar.yaml
            service_port: 5050
            organization: DefaultPeerOrg
            domain: example.com
          hosts:
            sidecar-machine:
              ansible_host: ttbed4.paris1

    clients:
      vars:
        ansible_user: cbdcdemo
      children:
        sidecarclients:
          vars:
            config: config-sidecar-client.yaml
            inherit_peer: peerservice-machine1 # Used for connecting to the orderer
            inherit_endorser: endorser-1 # Used for signing the TXs for the sig verifier
            limiter_port: 6997
          hosts:
            sidecar-client-machine1:
              profile: profile-sidecar-client.yaml
              ansible_host: ttbed4.london2

    monitoring:
      hosts:
        monitoring-machine:
          ansible_host: ttbed4.frankfurt2
          jaeger_exporter_port: 14268
          jaeger_optl_exporter_port: 4318