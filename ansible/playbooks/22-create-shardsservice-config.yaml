#
# SPDX-License-Identifier: Apache-2.0
#
---
- name: Create configs for shardsservice
  hosts: localhost
  vars:
    selected_hosts: "{{groups['shardsservices'] | d([]) | intersect(groups[target_hosts] | d([])) | map('extract', hostvars) | list}}"
  roles:
    - kwoodson.yedit
  tasks:
    - name: Create base config
      vars:
        config_root: shards-service
      include_tasks: ../subtasks/create-base-config.yaml
      when: "{{selected_hosts | length > 0}}"
    - name: Further edit shardsservice config
      yedit:
        src: "{{dst_dir}}/{{shardsservice_instance.inventory_hostname}}/{{shardsservice_instance.config}}"
        edits:
          - key: shards-service.database.root-dir
            value: "{{shardsservice_instance.db_dir}}"
      loop: "{{selected_hosts}}"
      loop_control:
        loop_var: shardsservice_instance
