#
# SPDX-License-Identifier: Apache-2.0
#
---
- name: Clean generated files
  hosts: "{{target_hosts}}"
  tasks:
    - file:
        state: absent
        path: "{{dir}}/"
      when: dir is defined and dir | length > 0
      loop:
        - "{{config_dir if include_configs | d(false) == true else ''}}"
        - "{{binary_dir if include_bins | d(false) == true else ''}}"
      loop_control:
        loop_var: dir
- hosts: "{{target_hosts}}:&orderingservices"
  tasks:
    - name: Clean orderer cache
      vars:
        top_dir: "{{config_dir}}/fabric.{{topology_name | d('')}}/orderers/{{organization}}.{{inventory_hostname}}"
      file:
        state: absent
        path: "{{dir}}/"
      loop:
        - "{{top_dir}}/etcdraft"
        - "{{top_dir}}/system"
      loop_control:
        loop_var: dir
      when: include_configs | d(false) == false
